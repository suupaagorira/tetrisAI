# Strategic Versus Mode - GUI Documentation

## 概要

Strategic Versus Modeは、戦略的AIの思考プロセスをリアルタイムで可視化する対戦モードです。
各プレイヤーの横に表示される思考パネルで、AIが何を考えているかを確認できます。

## 起動方法

### 1. GUIサーバーを起動

```bash
npm run gui
```

または開発モード（自動リロード付き）：

```bash
npm run gui:watch
```

### 2. ブラウザでアクセス

サーバーが起動したら、ブラウザで以下のURLにアクセスします：

```
http://localhost:5173/strategic.html
```

## UI構成

### 画面レイアウト

```
┌─────────────────────────────────────────────────────────┐
│              STRATEGIC AI VERSUS                        │
│         リアルタイム思考プロセス可視化                    │
├─────────────────────────────────────────────────────────┤
│  [開始] [一時停止] [1手進める] [リセット] [速度]       │
├──────────────┬─────────────────────┬─────────────────────┤
│   P1 思考    │   ゲームボード      │    P2 思考          │
│   パネル     │                      │    パネル           │
│              │   ┌──────────┐      │                     │
│ ・戦略       │   │ Player 1 │      │  ・戦略             │
│ ・テンプレート│   │  ボード  │      │  ・テンプレート     │
│ ・トリガー   │   └──────────┘      │  ・トリガー         │
│ ・評価値     │                      │  ・評価値           │
│ ・対戦状況   │   ┌──────────┐      │  ・対戦状況         │
│ ・パフォーマンス│ │ Player 2 │      │  ・パフォーマンス   │
│ ・思考根拠   │   │  ボード  │      │  ・思考根拠         │
│              │   └──────────┘      │                     │
│              │                      │                     │
│              │   試合ログ          │                     │
└──────────────┴─────────────────────┴─────────────────────┘
```

### 思考パネルの構成

各プレイヤーの思考パネルには以下の情報が表示されます：

#### 1. 📊 現在の戦略
- **Strategy**: 現在使用中の戦略（S1〜S6）
  - S1: B2B Pressure
  - S2: Defense & Cancel
  - S3: PC Utilization
  - S4: 4-Wide Dominance
  - S5: Cheese Farming
  - S6: Tempo Delay
- **Dwell Time**: その戦略を使用している時間（秒）

#### 2. 🎯 適用テンプレート
- **Template**: 現在適用中のテンプレート（T1〜T6）
  - T1: Emergency Clear
  - T2: T-Spin Setup
  - T3: Build 4-Wide
  - T4: Perfect Clear Setup
  - T5: Combo Chain
  - T6: Stable Downstack

#### 3. ⚡ トリガー発動（発動時のみ表示）
- **Trigger**: 発動したトリガーの種類（G1〜G7）
- **Reason**: トリガーが発動した理由

#### 4. 📈 評価値
- **Evaluation**: 選択された手の評価スコア
- **Candidates**: 評価した候補手の数
- **Beam Width**: ビームサーチの幅

#### 5. ⚔️ 対戦状況
- **Kill Probability**: 相手を倒せる確率（0〜100%）
- **Height Advantage**: 高さの優位性（正の値＝有利）
- **Attack Potential**: 攻撃ポテンシャル（0〜100%）

#### 6. ⏱️ パフォーマンス
- **Latency**: 意思決定にかかった時間（ミリ秒）
- **バー**: レイテンシーを視覚化（緑→黄→赤）
  - 緑: <4ms（目標値）
  - 黄: 4-8ms（許容範囲）
  - 赤: >8ms（要改善）

#### 7. 💭 思考根拠
- AIが選択した理由の詳細説明

## 操作方法

### コントロールボタン

| ボタン | 機能 |
|--------|------|
| 開始 | 対戦を開始します |
| 一時停止 | 対戦を一時停止/再開します |
| 1手進める | 一時停止中に1手だけ進めます（デバッグ用） |
| リセット | 対戦を最初からやり直します |
| 速度 | ゲームの進行速度を調整します |

### 速度設定

| 設定 | 速度 | 用途 |
|------|------|------|
| 超高速 | 50ms | 素早く結果を確認したい時 |
| 高速 | 100ms | テスト実行時 |
| 標準 | 200ms | 通常の観戦 |
| ゆっくり | 500ms | 思考プロセスを詳細に観察 |
| 低速 | 1000ms | 学習・分析用 |

## 思考プロセスの読み方

### 戦略切り替えの観察

1. **通常時**:
   - P1が「B2B Pressure」で安定してプレイ
   - 高さは適度に保たれている

2. **危機時**:
   - ボードが高くなる（15行以上）
   - → トリガー「G2: Safety Margin」が発動
   - → 戦略が「S2: Defense & Cancel」に切り替わる
   - → テンプレートが「T1: Emergency Clear」に変更

3. **チャンス時**:
   - 相手のボードが非常に高い
   - → Kill Probability が70%以上に
   - → トリガー「G1: Kill Window」が発動
   - → 戦略が「S5: Cheese Farming」に切り替わる
   - → 攻撃的なプレイで一気に攻める

### パフォーマンスの確認

- **Latency** が常に8ms以下であることを確認
- 緑色のバー = 目標達成（<4ms）
- 黄色のバー = 許容範囲（4-8ms）
- 赤色のバー = 改善が必要（>8ms）

### 評価値の意味

- **正の値**: その手は良い手
- **負の値**: その手は悪い手（高さが高い、穴が多いなど）
- **値が大きい**: より良い/悪い手

## トラブルシューティング

### 画面が表示されない

```bash
# ビルドを実行
npm run build

# GUIサーバーを再起動
npm run gui
```

### ゲームが動かない

1. ブラウザのコンソールを開く（F12キー）
2. エラーメッセージを確認
3. ページをリロード（Ctrl+R / Cmd+R）

### 思考パネルが更新されない

- 対戦が実際に進行しているか確認
- ブラウザのキャッシュをクリア
- ページをリロード

## 技術仕様

### フロントエンド

- TypeScript + esbuild
- Canvas API でボード描画
- リアルタイムUIアップデート

### バックエンド

- Express.js サーバー
- Strategic AI システム統合
- テレメトリーログ記録

### パフォーマンス

- 目標レイテンシー: 4ms
- P99要件: ≤8ms
- 実際の平均: 2-5ms

## 活用例

### 1. AI開発・デバッグ

- 戦略切り替えが正しく動作しているか確認
- トリガーの発動条件を視覚的に理解
- パフォーマンスボトルネックの発見

### 2. 学習・研究

- AIの思考プロセスを理解
- 各戦略の特徴を観察
- テンプレートの適用条件を学習

### 3. デモ・プレゼンテーション

- AIの高度な判断を視覚化
- リアルタイムで動作を説明
- 戦略的思考の透明性を示す

## カスタマイズ

### 初期戦略の変更

`src/gui/strategic_client.ts` を編集：

```typescript
this.matchState = {
  // ...
  agent1: createVersusAgent({
    initialStrategy: StrategyType.PC_UTILIZATION // ここを変更
  }),
  agent2: createVersusAgent({
    initialStrategy: StrategyType.CHEESE_FARMING // ここを変更
  }),
  // ...
};
```

### スピード調整

HTMLファイルの速度オプションを編集：

```html
<select id="speed-select">
  <option value="50">超高速</option>
  <option value="100">高速</option>
  <option value="200" selected>標準</option>
  <!-- 新しいオプションを追加 -->
</select>
```

## 今後の拡張案

- [ ] リプレイ機能
- [ ] テレメトリーの保存・エクスポート
- [ ] 複数マッチの統計表示
- [ ] 戦略の手動切り替えオプション
- [ ] グラフ表示（評価値の推移など）

## 関連ドキュメント

- [Strategic AI System](./strategic_ai.md) - 戦略的AIの詳細仕様
- [Feature Extraction](./strategic_ai.md#feature-extraction-f-system) - 特徴抽出の説明
- [Triggers](./strategic_ai.md#switch-triggers-g-system) - トリガーシステムの詳細
